CREATE TABLE departamento (
    id_departamento INT PRIMARY KEY AUTO_INCREMENT,
    nombre_departamento VARCHAR(100) NOT NULL UNIQUE,
    descripcion TEXT
) ENGINE=InnoDB;

CREATE TABLE empleado (
    id_empleado INT PRIMARY KEY AUTO_INCREMENT,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    id_departamento INT,
    puesto VARCHAR(100) NOT NULL,
    fecha_contratacion DATE NOT NULL,
    salario DECIMAL(10, 2) NOT NULL CHECK (salario >= 0),
    FOREIGN KEY (id_departamento) REFERENCES departamento(id_departamento) 
        ON DELETE SET NULL
        ON UPDATE CASCADE,
    INDEX (id_departamento)
) ENGINE=InnoDB;

CREATE TABLE proveedor (
    id_proveedor INT PRIMARY KEY AUTO_INCREMENT,
    nombre_proveedor VARCHAR(150) NOT NULL UNIQUE,
    telefono VARCHAR(15),
    email VARCHAR(100) UNIQUE,
    direccion VARCHAR(255),
    ciudad VARCHAR(100),
    pais VARCHAR(100)
) ENGINE=InnoDB;

CREATE TABLE categoria (
    id_categoria INT PRIMARY KEY AUTO_INCREMENT,
    nombre_categoria VARCHAR(100) NOT NULL UNIQUE,
    descripcion TEXT
) ENGINE=InnoDB;

CREATE TABLE tipo_movimiento (
    id_tipo_movimiento INT PRIMARY KEY AUTO_INCREMENT,
    tipo VARCHAR(10) NOT NULL UNIQUE
) ENGINE=InnoDB;

CREATE TABLE producto (
    id_producto INT PRIMARY KEY AUTO_INCREMENT,
    nombre_producto VARCHAR(150) NOT NULL,
    descripcion TEXT,
    precio_unitario DECIMAL(10, 2) NOT NULL CHECK (precio_unitario >= 0),
    id_proveedor INT,
    id_categoria INT,
    stock_actual INT DEFAULT 0 CHECK (stock_actual >= 0),
    stock_minimo INT DEFAULT 0 CHECK (stock_minimo >= 0),
    fecha_ingreso DATE DEFAULT CURDATE(),
    FOREIGN KEY (id_proveedor) REFERENCES proveedor(id_proveedor) 
        ON DELETE SET NULL 
        ON UPDATE CASCADE,
    FOREIGN KEY (id_categoria) REFERENCES categoria(id_categoria) 
        ON DELETE SET NULL 
        ON UPDATE CASCADE,
    INDEX (id_proveedor),
    INDEX (id_categoria)
) ENGINE=InnoDB;

CREATE TABLE movimiento_stock (
    id_movimiento INT PRIMARY KEY AUTO_INCREMENT,
    id_producto INT,
    id_tipo_movimiento INT,
    cantidad INT NOT NULL CHECK (cantidad > 0),
    fecha_movimiento DATE NOT NULL DEFAULT CURDATE(),
    descripcion TEXT,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto) 
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    FOREIGN KEY (id_tipo_movimiento) REFERENCES tipo_movimiento(id_tipo_movimiento) 
        ON DELETE CASCADE,
    INDEX (id_producto),
    INDEX (id_tipo_movimiento)
) ENGINE=InnoDB;

CREATE TABLE ventas (
    id_venta INT PRIMARY KEY AUTO_INCREMENT,
    id_producto INT,
    cantidad INT NOT NULL CHECK (cantidad > 0),
    total DECIMAL(10, 2) NOT NULL CHECK (total >= 0),
    fecha_venta DATE NOT NULL DEFAULT CURDATE(),
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto) 
        ON DELETE CASCADE,
    INDEX (id_producto)
) ENGINE=InnoDB;


CREATE TABLE cliente (
    id_cliente INT PRIMARY KEY AUTO_INCREMENT,
    nombre_cliente VARCHAR(100) NOT NULL,
    telefono VARCHAR(15),
    email VARCHAR(100) UNIQUE,
    direccion VARCHAR(255),
    ciudad VARCHAR(100),
    pais VARCHAR(100)
) ENGINE=InnoDB;

CREATE TABLE factura (
    id_factura INT PRIMARY KEY AUTO_INCREMENT,
    id_cliente INT,
    id_venta INT,
    fecha_emision DATE NOT NULL DEFAULT CURDATE(),
    total DECIMAL(10, 2) NOT NULL CHECK (total >= 0),
    FOREIGN KEY (id_cliente) REFERENCES cliente(id_cliente) 
        ON DELETE SET NULL,
    FOREIGN KEY (id_venta) REFERENCES ventas(id_venta) 
        ON DELETE CASCADE
) ENGINE=InnoDB;

CREATE TABLE descuento (
    id_descuento INT PRIMARY KEY AUTO_INCREMENT,
    porcentaje DECIMAL(5, 2) NOT NULL CHECK (porcentaje >= 0),
    fecha_inicio DATE,
    fecha_fin DATE
) ENGINE=InnoDB;

CREATE TABLE proveedores_productos (
    id INT PRIMARY KEY AUTO_INCREMENT,
    id_proveedor INT,
    id_producto INT,
    FOREIGN KEY (id_proveedor) REFERENCES proveedor(id_proveedor) 
        ON DELETE CASCADE,
    FOREIGN KEY (id_producto) REFERENCES producto(id_producto) 
        ON DELETE CASCADE
) ENGINE=InnoDB;

CREATE TABLE promociones (
    id_promocion INT PRIMARY KEY AUTO_INCREMENT,
    nombre_promocion VARCHAR(100),
    descuento_id INT,
    fecha_inicio DATE,
    fecha_fin DATE,
    FOREIGN KEY (descuento_id) REFERENCES descuento(id_descuento) 
        ON DELETE SET NULL
) ENGINE=InnoDB;